# 楼宇清洁小管家


**填写说明：**  
- 请按照模板要求填写各项内容。
- 方案作为评比主要交付件之一，请尽量做到内容完整、图文并茂、通俗易懂、思路清晰。
- 项目方案中第一次出现外文名词时，要写清全称和缩写，再出现同一词时可以使用缩写。

一、背景和介绍
==============

1、公司/团队介绍
----------------
（1）请您简要介绍下贵公司（或者开发团队），所从事的行业、主要产品和优势等。  

- 中科院自动化研究所远程智能医疗团队，以发展第三代远程医疗为目标，开展智能化远程医疗关键技术系统研究，主要研究方向为：智能物联网平台、柔性服务机械臂、智能声图文处理、系列化医疗服务机器人。
- 游博，嵌入式软件工程师，负责物联网网络通信和机器人语音识别、导航定位相关课题研究和系统设计。

2、项目介绍
-----------

**项目简介：**
简要介绍参与本次活动所开发的项目成熟度，如：纯创意阶段、正在进行需求调研、已完成功能设计、已完成初步开发、已完成原型设计、已完成第一版产品或解决方案、正在进行试用等。  

（1）简要阐述参与本次活动所开发的项目的行业现状，包括市场上的主流技术，涌现出的新技术，未来的发展趋势。

- 楼宇清洁小管家项目属于本人的创意项目，目前处于纯创意阶段。
- 楼宇清洁小管家是一个智能机器人，通过安装在垃圾桶上的传感器，采集垃圾桶异味、是否已满等状态，并传输到物联网云平台，并触发楼宇清洁小管家（机器人）进行自动路径规划，完成倒垃圾并将垃圾桶归为原位动作。

（2）应用场景：本项目面向的市场需求，行业现状，应用场景和用户对象等。

- 现目前各办公楼宇中通常每层配备几名服务人员，分别负责办公区域、厕所区域等地的清洁工作，通常清洁人员需要频繁查询垃圾桶状况以及时清理，工作效率低下。
- 楼宇清洁小管家主要是为了替代低层次服务人员重复劳动，应用于大型办公写字楼等地方，减少廉价劳动力开支。

（3）概述本项目设计特点与亮点，包括但不限于创意新颖性、设计独特性分析等内容。

- 不是单纯的设计智能垃圾桶，也不需要清洁人员在云平台监控各个垃圾桶状况并处理，而是从感知到自动处理形成闭环，楼宇清洁小管家自动完成，不用人工干涉，真正实现廉价劳动的解放。
- 目前只是涉及到垃圾桶，后续可以针对楼宇中其他设施，进行扩展。

（4）市场前景分析，商业或应用模式，项目计划及可行性分析等补充内容。

- 随着服务机器人、物联网等相关技术的发展，以及物物相连的迫切需求，设计能够替代廉价劳动人员的服务机器人，并与边缘设备互联互通，实现智联网是未来的发展趋势。

二、项目内容
============

1、方案说明
-----------
（1）项目（产品）功能详细说明。

- 垃圾桶安装气味、红外传感器，检测垃圾异味和是否已满状态，并上传至网关。
- 网关将每一层楼所有垃圾桶信息上传至云平台。
- 楼宇清洁小管家从云平台获取楼宇中所有垃圾桶状态，对于需要清洁的某一个垃圾桶予以及时响应。

拓扑结构如下图所示：
![](http://osjn6k0nm.bkt.clouddn.com/%E6%8B%93%E6%89%91%E7%BB%93%E6%9E%84.png)

（2）IoT平台对接方案详细说明。包括对接第三方云平台的协议、接入方式，对接的功能架构等（并附上相关图示）。

- 对接AWS IOT云平台。
- 对接协议为MQTT+TLS
- 接入方式：垃圾桶和网关之间用WiFi/zigbee等无线通信，网关和云平台之间用以太网，机器人和云平台之间用WiFi。


（3）所对接的第三方IoT云平台的简介。简述该平台的特点与优势。  

- 亚马逊AWS(Amazon Web Services (AWS))是亚马逊提供的专业云计算服务。在物联网方面提供AWS IOT core、AWS greengrass、AWS freeRTOS等多个物联网产品。这里对接的是AWS IOT core。其包含身份验证授权、规则引擎、设备影子等功能。
- 国内外各公司近两年推出许多物联网平台，AWS IOT比阿里、腾讯、百度相关物联网平台更早出现。相关比较参考[国内外物联网平台初探系列][1]。
- AWS IOT提供了基于多种平台的SDK，包括Android、嵌入式C、iOS、Java、Javascript、Python等，方便创建网页、app等应用程序。
[1]: https://mp.weixin.qq.com/s/12cisL_oqp8BI5udhXX1hQ



2、硬件方案
-----------
详细介绍本项目的硬件方案，包括但不限于硬件架构、硬件列表、电气原理图等（并附上相关图示）。  

- 本项目暂时没有涉及网关和机器人，直接将垃圾桶数据通过网络传输到云平台。
- 使用stm32f429开发板模拟垃圾桶，外接气体传感器和红外传感器。气体传感器检测是否出现异味，红外传感器检测是否已满。
- 使用网线连接stm32f429开发板到路由器上网。

3、软件方案
-----------
详细介绍软件方案，包括但不限于软件整体架构，功能模块划分，主要模块功能分析等（并附上相关图示）。

详细介绍LiteOS与云平台对接实现过程，包括协议栈，平台接口等； 

*因为不涉及网关和机器人，这里只论述stm32f429开发板与云平台交互的软件方案。*

- 移植LWIP协议栈，实现以太网通信。
- 移植mbedtls协议，实现网络加密与认证。
- 移植aws-iot-device-sdk-embedded-C，实现AWS IOT的功能接入。 


三、接入第三方云平台
====================

AWS IOT接入方法，详情参考[AWS IOT developer guide][2]
[2]: https://docs.aws.amazon.com/iot/latest/developerguide/iot-sdks.html

1、云平台账号注册
-----------------
详细介绍账号获取过程，可以按步骤描述。  

- 略

2、云平台使用
-----------------
请依据所选择的云平台，详细阐述产品创建过程。因为不同的云平台接入过程不能通用，此产品创建及后续设备管理等流程，请根据各不同云平台适当调整。  

AWS IOT使用包括以下步骤：

- 创建事物
- 创建并激活证书（事物证书、事物公钥、事物密钥）
- 创建AWS IOT策略
- 将AWS IOT策略附加到设备证书
- 将证书附加到事物上
- 将事物证书和密钥、根证书配置到设备中
- 发布/订阅消息
这里我创建了名为garbagecan01的事物，步骤如图：
![](http://osjn6k0nm.bkt.clouddn.com/aws%20thing1.JPG) 
![](http://osjn6k0nm.bkt.clouddn.com/aws%20thing2.JPG)
![](http://osjn6k0nm.bkt.clouddn.com/aws%20thing3.JPG)
![](http://osjn6k0nm.bkt.clouddn.com/aws%20thing4.JPG)
![](http://osjn6k0nm.bkt.clouddn.com/aws%20thing5.JPG)
![](http://osjn6k0nm.bkt.clouddn.com/aws%20thing6.JPG)
![](http://osjn6k0nm.bkt.clouddn.com/aws%20thing7.JPG)
![](http://osjn6k0nm.bkt.clouddn.com/aws%20thing8.JPG)

四、关键源代码解析
==================

本次源代码参考了以下代码：

- 5-以太网Lwip例程.zip(秉火stm32f429开发板提供)
- en.x-cube-aws.zip(AWS IoT Core 初学者工具包:STM32 IoT Discovery 节点)

1、程序文件介绍
---------------
- arch 体系架构
- Common mbedtls和AWS需要使用的公共代码
- driver 开发板驱动
- third_party/AWS AWS相关代码
- third_party/LWIP lwip2.0.3(暂未使用)
- third_party/lwip-1.4.1 lwip1.4.1相关代码
- third_party/mbedTLS mbedTLS相关代码


2、程序主函数说明
-----------------

- 在主函数中创建任务，完成相关功能。
- void LwIP_DHCP_task(void)是LWIP DHCP任务。
- void cloud_test(void)是云平台测试任务。

3、关键代码说明
---------------

1. LWIP移植
	- 本次项目移植LWIP版本为1.4.1。
	- 参考《5-以太网Lwip例程.zip》中的《以太网—基于uCOS-III的LwIP移植（DHCP）》代码。
	- 主要修改sys_arch.c文件，其中信号量、消息队列、创建新线程、中断保护相关函数需要用liteos的API函数实现。
	- ethernetif.c中的Ethernetif_input函数和netconf.c中的LWIP_DHCP_task函数中涉及的延时函数要用liteos相关延时函数实现。
	- 注意各个任务的优先级。
	
2. mbedtls与AWS移植
	- setRTCTimeDateFromNetwork函数实现从网络中获取实时时间。
	- 定义USE_MBED_TLS宏，需要引入CA cert。
	- 目前该函数出错，出现hardfault错误，尚未解决。
	- AWS移植，需要根据下载的证书密钥以及根证书做相关配置。配置内容包括：
		- 服务器地址
		- 根证书
		- 事物证书
		- 事物密钥
		- 事物名称
		- 事物ID

4、上传数据代码详解
-------------------

- 待完成

3、下发命令代码详解
-------------------

- 待完成

五、产品调试
============

1、硬件调试
-----------
请辅助照片、图表及视频等内容，详细介绍接线、硬件调试，能清晰的看到整个调试过程。  

- stm32f429开发板连接网线到路由器。

2、软件调试
-----------
（1）调试过程综述。

- 下载并烧写程序到开发板。
- 运行程序，打开调试串口，115200-8-N-1，观察现象。
- ……

（2）上报数据调试过程。

- 待完成

（3）下发命令调试过程。  
*请辅助照片、图表及视频等内容。*

- 待完成

六、第三方云平台能力展示
========================

1、云平台API使用说明
--------------------
详细说明平台API使用情况。

- 待完成

2、平台能力展示
---------------
请结合本项目的行业属性，展示第三方云平台提供的能力。例如趋势预测、云通讯、大数据分析、设备全生命周期管理、云数据库使用、远程升级功能、GIS展示等（根据云平台提供的能力）。  

- 待完成

3、WEB或移动APP展示
-------------------
若有WEB或APP移动端，请展示相关能力。  

- 待完成

